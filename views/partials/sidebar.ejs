<!-- Sidebar -->
<aside class="w-64 flex-shrink-0 hidden lg:block">
    <div class="sticky top-24 space-y-4">

        <!-- Date Filter -->
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-slate-700 p-4">
            <h2 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-3">
                <i class="fa-regular fa-calendar mr-2"></i>Date Range
            </h2>

            <nav class="space-y-1">
                <button @click="setDatePreset('today')"
                        :class="datePreset === 'today' ? 'bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400' : 'hover:bg-gray-50 dark:hover:bg-slate-700'"
                        class="w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm transition-colors">
                    <span>Today</span>
                    <span class="text-xs bg-gray-100 dark:bg-slate-600 px-1.5 py-0.5 rounded-full min-w-[1.5rem] text-center" x-text="dateCounts.today"></span>
                </button>
                <button @click="setDatePreset('yesterday')"
                        :class="datePreset === 'yesterday' ? 'bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400' : 'hover:bg-gray-50 dark:hover:bg-slate-700'"
                        class="w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm transition-colors">
                    <span>Yesterday</span>
                    <span class="text-xs bg-gray-100 dark:bg-slate-600 px-1.5 py-0.5 rounded-full min-w-[1.5rem] text-center" x-text="dateCounts.yesterday"></span>
                </button>
                <button @click="setDatePreset('last7')"
                        :class="datePreset === 'last7' ? 'bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400' : 'hover:bg-gray-50 dark:hover:bg-slate-700'"
                        class="w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm transition-colors">
                    <span>Last 7 days</span>
                    <span class="text-xs bg-gray-100 dark:bg-slate-600 px-1.5 py-0.5 rounded-full min-w-[1.5rem] text-center" x-text="dateCounts.last7"></span>
                </button>
                <button @click="setDatePreset('last30')"
                        :class="datePreset === 'last30' ? 'bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400' : 'hover:bg-gray-50 dark:hover:bg-slate-700'"
                        class="w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm transition-colors">
                    <span>Last 30 days</span>
                    <span class="text-xs bg-gray-100 dark:bg-slate-600 px-1.5 py-0.5 rounded-full min-w-[1.5rem] text-center" x-text="dateCounts.last30"></span>
                </button>
                <button @click="setDatePreset('thisMonth')"
                        :class="datePreset === 'thisMonth' ? 'bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400' : 'hover:bg-gray-50 dark:hover:bg-slate-700'"
                        class="w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm transition-colors">
                    <span>This month</span>
                    <span class="text-xs bg-gray-100 dark:bg-slate-600 px-1.5 py-0.5 rounded-full min-w-[1.5rem] text-center" x-text="dateCounts.thisMonth"></span>
                </button>
            </nav>

            <!-- Custom Range -->
            <div class="mt-3 pt-3 border-t border-gray-200 dark:border-slate-700">
                <button @click="setDatePreset('custom')"
                        :class="datePreset === 'custom' ? 'bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400' : 'hover:bg-gray-50 dark:hover:bg-slate-700'"
                        class="w-full text-left px-3 py-2 rounded-lg text-sm transition-colors mb-2">
                    <i class="fa-solid fa-sliders mr-1"></i> Custom range
                </button>
                <div x-show="datePreset === 'custom'" x-cloak class="space-y-2 px-1">
                    <div>
                        <label class="text-xs text-gray-500 dark:text-gray-400">From</label>
                        <input type="date" x-model="customDateFrom"
                               @change="localStorage.setItem('chronicle_dateFrom', customDateFrom)"
                               class="w-full px-2 py-1.5 text-sm rounded border border-gray-200 dark:border-slate-600
                                      bg-gray-50 dark:bg-slate-700 focus:ring-2 focus:ring-primary-500 outline-none">
                    </div>
                    <div>
                        <label class="text-xs text-gray-500 dark:text-gray-400">To</label>
                        <input type="date" x-model="customDateTo"
                               @change="localStorage.setItem('chronicle_dateTo', customDateTo)"
                               class="w-full px-2 py-1.5 text-sm rounded border border-gray-200 dark:border-slate-600
                                      bg-gray-50 dark:bg-slate-700 focus:ring-2 focus:ring-primary-500 outline-none">
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Tools Filter -->
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-slate-700 p-4">
            <div class="flex items-center justify-between mb-3">
                <h2 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide">
                    <i class="fa-solid fa-wand-magic-sparkles mr-2"></i>AI Tools
                </h2>
                <button x-show="selectedTools.length > 0"
                        @click="clearTools()"
                        class="text-xs text-gray-400 hover:text-primary-500">
                    Clear (<span x-text="selectedTools.length"></span>)
                </button>
            </div>

            <nav class="space-y-1">
                <template x-for="tool in availableTools" :key="tool.id">
                    <label class="flex items-center gap-2 px-2 py-1.5 rounded-lg text-sm cursor-pointer transition-colors"
                           :class="isToolSelected(tool.id) ? 'bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400' : 'hover:bg-gray-50 dark:hover:bg-slate-700'">
                        <input type="checkbox"
                               :checked="isToolSelected(tool.id)"
                               @change="toggleTool(tool.id)"
                               class="rounded border-gray-300 dark:border-slate-600 text-primary-500 focus:ring-primary-500">
                        <i class="fa-solid" :class="[tool.icon, tool.color]"></i>
                        <span class="flex-1 truncate" x-text="tool.name"></span>
                        <span class="text-xs bg-gray-100 dark:bg-slate-600 px-1.5 py-0.5 rounded-full min-w-[1.5rem] text-center" x-text="toolCounts[tool.id] || 0"></span>
                    </label>
                </template>
            </nav>
        </div>

        <!-- Tags Filter -->
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-slate-700 p-4">
            <div class="flex items-center justify-between mb-3">
                <h2 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide">
                    <i class="fa-solid fa-tags mr-2"></i>Tags
                </h2>
                <button x-show="selectedTags.length > 0"
                        @click="clearTags()"
                        class="text-xs text-gray-400 hover:text-primary-500">
                    Clear (<span x-text="selectedTags.length"></span>)
                </button>
            </div>

            <!-- Tags List -->
            <nav class="space-y-1">
                <template x-for="tag in tags" :key="tag.id">
                    <div class="group flex items-center gap-2 px-2 py-1.5 rounded-lg text-sm cursor-pointer transition-colors"
                         :class="isTagFilterSelected(tag.id) ? 'bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400' : 'hover:bg-gray-50 dark:hover:bg-slate-700'">
                        <!-- Checkbox + Label -->
                        <template x-if="editingTagId !== tag.id">
                            <label class="flex items-center gap-2 flex-1 cursor-pointer">
                                <input type="checkbox"
                                       :checked="isTagFilterSelected(tag.id)"
                                       @change="toggleTagFilter(tag.id)"
                                       class="rounded border-gray-300 dark:border-slate-600 text-primary-500 focus:ring-primary-500">
                                <span class="truncate" x-text="tag.label"></span>
                            </label>
                        </template>
                        <template x-if="editingTagId === tag.id">
                            <input type="text" x-model="editingTagLabel" @blur="saveTagEdit(tag.id)" @keydown.enter="saveTagEdit(tag.id)" @keydown.escape="cancelTagEdit()"
                                   class="flex-1 px-1 py-0.5 text-sm border border-primary-300 rounded bg-white dark:bg-slate-800 focus:outline-none"
                                   x-ref="tagInput">
                        </template>
                        <!-- Edit/Delete on hover -->
                        <div class="w-8 flex items-center justify-end gap-1 opacity-0 group-hover:opacity-100 transition-opacity" @click.stop>
                            <button @click="startTagEdit(tag)" class="p-0.5 text-gray-400 hover:text-primary-500">
                                <i class="fa-solid fa-pen text-xs"></i>
                            </button>
                            <button x-show="tag.count === 0" @click="removeTag(tag.id)" class="p-0.5 text-gray-400 hover:text-red-500">
                                <i class="fa-solid fa-trash text-xs"></i>
                            </button>
                        </div>
                        <span class="text-xs bg-gray-100 dark:bg-slate-600 px-1.5 py-0.5 rounded-full min-w-[1.5rem] text-center" x-text="tag.count"></span>
                    </div>
                </template>

                <!-- Inline Add Tag -->
                <div class="flex items-center gap-1 mt-2">
                    <input type="text" x-model="newTagLabel" placeholder="New tag..."
                           @keydown.enter="addTag()"
                           class="flex-1 px-2 py-1 text-sm rounded border border-gray-200 dark:border-slate-600 bg-gray-50 dark:bg-slate-700 focus:ring-1 focus:ring-primary-500 outline-none">
                    <button @click="addTag()" :disabled="!newTagLabel.trim()"
                            class="px-2 py-1 bg-primary-500 text-white text-xs rounded hover:bg-primary-600 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>
            </nav>
        </div>

        <!-- Projects Filter -->
        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-slate-700 p-4">
            <div class="flex items-center justify-between mb-3">
                <h2 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide">
                    <i class="fa-solid fa-folder mr-2"></i>Projects
                </h2>
                <button x-show="selectedProjects.length > 0"
                        @click="clearProjects()"
                        class="text-xs text-gray-400 hover:text-primary-500">
                    Clear (<span x-text="selectedProjects.length"></span>)
                </button>
            </div>

            <!-- Project Search -->
            <div class="relative mb-2">
                <i class="fa-solid fa-search absolute left-2.5 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i>
                <input type="text" x-model="projectSearch" placeholder="Filter projects..."
                       class="w-full pl-7 pr-3 py-1.5 text-sm rounded border border-gray-200 dark:border-slate-600
                              bg-gray-50 dark:bg-slate-700 focus:ring-2 focus:ring-primary-500 outline-none">
            </div>

            <nav class="space-y-1 max-h-72 overflow-y-auto">
                <template x-for="proj in projectsList" :key="proj.name">
                    <label x-show="isProjectVisible(proj.name)"
                           class="flex items-center gap-2 px-2 py-1.5 rounded-lg text-sm cursor-pointer transition-colors"
                           :class="isProjectSelected(proj.name) ? 'bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400' : 'hover:bg-gray-50 dark:hover:bg-slate-700'">
                        <input type="checkbox"
                               :checked="isProjectSelected(proj.name)"
                               @change="toggleProject(proj.name)"
                               class="rounded border-gray-300 dark:border-slate-600 text-primary-500 focus:ring-primary-500">
                        <span class="truncate flex-1" x-text="proj.name.split('/').pop()"></span>
                        <span class="text-xs bg-gray-100 dark:bg-slate-600 px-1.5 py-0.5 rounded-full min-w-[1.5rem] text-center" x-text="proj.count"></span>
                    </label>
                </template>
            </nav>
        </div>

    </div>
</aside>
